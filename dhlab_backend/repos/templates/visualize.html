{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}{{ account_name }} / {{ repo.name }}{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href='{% static "css/viz.css" %}'>
<link rel="stylesheet" type="text/css" href='{% static "css/leaflet.css" %}'>
<link rel="stylesheet" type="text/css" href='{% static "css/MarkerCluster.css" %}'>
<link rel="stylesheet" type="text/css" href='{% static "css/MarkerCluster.Default.css" %}'>
{% endblock %}

{% block js %}
<script id='form_id' type='text/plain'>{{ sid }}</script>
<script id='user' type='text/plain'>{{ user.username }}</script>
<script>
	document.cdn = '{% static "" %}'
</script>
<script data-main='{% static "js/viz/main" %}' src='{% static 'js/vendor/require-jquery.js' %}'></script>

<!-- Chart viz -->
<script src='{% static "js/vendor/d3.v3.min.js" %}'></script>

<script type='text/javascript'>
	$( function() {
		// Initialize data
		document.initial_data = {{data|safe }};
	});
</script>
{% endblock %}

{% block content %}
<div class='container'>
	<div class='row'>
		<div class='span12'>
			<div id='privacy'>
				<div>
					{% if repo.is_public %}
						<i class='icon-unlock'></i>&nbsp;PUBLIC
					{% else %}
						<i class='icon-lock'></i>&nbsp;PRIVATE
					{% endif %}
				</div>
			</div>
			<h3>
				<div class='pull-right'>
					<a class='btn' href='/api/v1/data/{{ sid }}?format=csv&amp;user={{account.username}}'>
						<i class='icon-download'></i> Download All Data
					</a>
				</div>
				{% if account.username %}
					<a href='{% url "user_dashboard" username=account.username %}'>{{ account.username }}</a> /
				{% else %}
					<a href='{% url "organization_dashboard" org=account.name %}'>{{ account.name }}</a> /
				{% endif %}
				<div class='btn-group'>
					<a class='btn dropdown-toggle' data-toggle='dropdown' href='#'>
						{{ repo.name }}
						<span class='caret'></span>
					</a>
					<ul class='dropdown-menu'>
						<li>
							<a href='/api/v1/repos/{{ sid }}?format=json&amp;user={{ account }}'>
								Download as JSON
							</a>
						</li>
						<li>
							<a href='/api/v1/repos/{{ sid }}?format=xform&amp;user={{ account }}'>
								Download as XForm
							</a>
						</li>
					</ul>
				</div>
			</h3>
			{% if repo.description %}
			<div class='well well-small'>
				{{ repo.description }}
			</div>
			{% endif %}
		</div>
	</div>
</div>
<div class='container' id='viz'>
	<div class='row'>
		<div class='span12'>
			<ul id='viz_options' class='nav nav-tabs'>
				<li id='raw_btn' class='active'>
					<a href='#' data-type='raw'>
						<div><i class='icon-list'></i></div>
						<div>Raw</div>
					</a>
				</li>
				<li id='map_btn' class='disabled'>
					<a href='#' data-type='map'>
						<div><i class='icon-map-marker'></i></div>
						<div>Map</div>
					</a>
				</li>
				<li id='line_btn'>
					<a href='#' data-type='line'>
						<div><i class='icon-signal'></i></div>
						<div>Analytics</div>
					</a>
				</li>
				{% if 'delete_repository' in permissions %}
				<li>
					<a href='#' data-type='settings'>
						<div><i class='icon-cog'></i></div>
						<div>Settings</div>
					</a>
				</li>
				<li>
					<a href='#' data-type='share'>
						<div><i class='icon-group'></i></div>
						<div>Share Data</div>
					</a>
				</li>
				{% endif %}
			</ul>
		</div>
	</div>
	<div class='row viz viz-active' id='raw_viz'>
		<div class='span12' style='margin-bottom:16px;'>
	        <div class='pull-right'>
	        	<label>
	        		<input id='test' type='checkbox'>
	        		Has Photos
	        	</label>
	        </div>
			View as:&nbsp;
			<div class='btn-group'>
	            <button data-type='list' class='btn active'>
	            	<i class='icon-align-justify'></i>&nbsp;List
	            </button>
	            <button data-type='grid' class='btn'>
	            	<i class='icon-th-large'></i>&nbsp;Grid
	            </button>
	        </div>
		</div>
		<div class='span12 active' id='raw_list'>
			<table id="raw_table" class="table table-striped table-bordered">
				<thead><tr></tr></thead>
				<tbody></tbody>
			</table>
		</div>
		<div class='span12' id='raw_grid' style='display:none;position:relative;'></div>
	</div>
	<div class='row viz' id='map_viz'>
		<div id='hidden_map'></div>
		<div class='span12' id='map'></div>
	</div>
	<div class='row viz' id='line_viz'>
		<div class='span2'>
			<h4>Y-Axis Options</h4>
			<div id='yaxis_options'></div>
		</div>
		<div class='span10' id='line'></div>
	</div>
	{% if 'delete_repository' in permissions %}
	<div class='row viz' id='settings_viz'>
		<div class='span12'>
            <div class='span3'>
				<strong>Edit this data repository</strong>
			</div>
			<div class='span8' style='text-align:right;padding-top:16px;'>
				<a href='{% url "repo_edit" repo_id=sid %}' class='btn btn-medium'>
                    Edit Repository
				</a>
			</div>
			<div class='span3'>
				<strong>Delete this data repository</strong>
				<span class='help-block'>
					Once you delete a repository, <strong>ALL</strong> data will
					be removed.
				</span>
			</div>
			<div class='span8' style='text-align:right;padding-top:16px;'>
				<a href='{% url "repo_delete" repo_id=sid %}' class='btn btn-danger'>
					<i class='icon-trash'></i> Delete Repository
				</a>
			</div>
		</div>
	</div>
	<div class='row viz' id='share_viz'>
		<div class='span12'>
			<h4>Data Sharing Settings</h4>
			<hr>
		</div>
		<div class='span12'>
			<div class='span3'>
				<strong>Who can see this data?</strong>
			</div>
			<div class='span6'>
				<label class='checkbox'>
					<input id='sharing_toggle' type='checkbox' {% if repo.public %}checked='checked'{% endif %}>
					Allow data sharing
				</label>
				<span class='help-block'>
					WARNING: Checking this box will make the data in this repository completely <strong>public</strong>.
				</span>
			</div>
		</div>
		<div style='display:none;'>
			<div class='span12'><hr></div>
			<div class='span12'>
				<div class='span3'>
					<strong>How is my data shown?</strong>
				</div>
				<div class='span6'>
					<div>
						<label class='checkbox'>
							<input type='checkbox'>
							Preserve Data Privacy
						</label>
						<span class='help-block'>
							If you allow data sharing, by default we will ensure that
							the data shown will also preserve the privacy of any
							individuals who entered data.
						</span>
					</div>
					<div>
						<label class='checkbox'>
							<input type='checkbox'>
							Show Raw Data
						</label>
					</div>
					<div>
						<label class='checkbox'>
							<input type='checkbox'>
							Show Map Data
						</label>
					</div>
					<div>
						<label class='checkbox'>
							<input type='checkbox'>
							Show Line Data
						</label>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
</div>
{% endblock %}
