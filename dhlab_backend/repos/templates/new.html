{% extends 'base.html' %}
{% load staticfiles %}

{% block js %}
<script src="{% static 'js/form_builder.js' %}"></script>
{% if repo_json %}
<script id='form_id' type='text/javascript'>var repo = {{ repo_json | safe }};</script>
{% endif %}
<script type='text/javascript'>
	$( function() {
		$( '#build_form' ).click( function() {
			$( this ).hide();
			$( '#survey_builder' ).show();
		});
	});
</script>
{% endblock %}

{% block title %}Create new data repository{% endblock %}

{% block content %}
<div class='row' style='margin-top:16px;'>
	<div class='span12'>
		<form action='.' method='post' enctype='multipart/form-data'>
			{% csrf_token %}

			<label {% if form.name.errors %}style='color:red'{%endif%}>
				<strong>Repository name</strong>
			</label>
			{{ form.name }}
			{{ form.name.errors }}

			<label>
				<strong>Description (optional)</strong>
			</label>
			<textarea rows='5' name='desc' class='input-xxlarge'></textarea>
			{{ form.desc.errors }}

			<hr/>

				<p>
				<div>
					<a href='javascript:void;' id='build_form' class='btn btn-medium'>
						Build XForm Manually
					</a>
					{{ form.survey_json }}
				</div>
				<div id='survey_builder' style='display:none;'>
					<!--  Table for Survey Questions  -->
					<table class='table table-striped table-bordered'>
					<thead>
						<tr>
							<td colspan='3' style='background-color:#EEE;'>
								<h4>
									<div class='pull-right'>
										<button type='button' id='addquestion' onclick='editQuestion(null)' class="btn btn btn-medium">Add Question</button>
									</div>
									Survey Questions
								</h4>
							</td>
						</tr>
					</thead>
					<tbody id='questionList'>

					</tbody>
					</table>

					<!-- Modal View For Editing Question-->
					<div id='questionEditWindow' class='modal hide fade'>

						<div class="modal-header">
							<a href="#" class="close" data-dismiss="modal">&times;</a>
							<h3>New Question</h3>
						</div>
						<div class="modal-body">

							<div>
								Name:
								<input id="questionName" name="questionName" onKeyUp="sanitizeNameInput(this)" type="text" />
							</div>

							<div>
								Label:
								<input id="questionLabel" name="label" type="text" />
							</div>

							<div>
								<input id='questionRequired' type="checkbox">
								<label for='questionRequired'>Required Question</label>
							</div>
								<input id='questionHintUse' type="checkbox" onclick='toggleHint()'>
								<label for='questionHintUse'>Use Question Hint</label>
								<div id='questionHintDiv'></div>
							<div>

							</div>

							<div>
							Type:
							<select id='questionType' onchange='questionTypeChanged()'>
								<option value='note'>Note</option>
								<option value='decimal'>Decimal</option>
								<option value='integer'>Integer</option>
								<option value='text'>Text</option>
								<option value='geopoint'>GeoPoint</option>
								<option value='time'>Time</option>
								<option value='dateTime'>Date Time</option>
								<option value='date'>Date</option>
								<option value='select one'>Select One</option>
								<option value='select all that apply'>Select Multiple</option>
								<option value='photo'>Photo</option>
								<option value='audio'>Audio</option>
								<option value='video'>Video</option>
								<option value='barcode'>Barcode</option>
                                <option value='group'>Group</option>
							</select>
							</div>

							<div id="choices">

							</div>

							<div id="constraints">

							</div>

							<div id="relevances">

							</div>

						</div>
						<div class="modal-footer">
							<!--a href="#" data-toggle="modal" class="btn" onclick="closeDialog();">Cancel</a-->
							<a  data-toggle="modal" href="#questionEditWindow" class="btn">Cancel</a>
							<!--a href="#" class="btn btn-primary" onclick="okClicked();">OK</a-->
							<input type='button' value='OK' class="btn btn-primary" onclick="okClicked();">
						</div>
					</div>
				</div>
				</p>

            <div id="xform_file_upload">
			<label {% if form.xform_file.errors %}style='color:red'{%endif%}>
				<strong>XForm File</strong>
			</label>
			{{ form.xform_file }}
			<span class='help-block'>
				Learn more about XForms <a href='http://en.wikipedia.org/wiki/XForms'>here</a>
			</span>
            </div>
			{{ form.non_field_errors }}
			{{ form.xform_file.errors }}
			{{ form.survey_json.errors }}
			<hr/>

			<label class='radio'>
				<input type='radio' name='privacy' value='public' style='margin-top:16px;'>
				<div class='pull-left' style='width:32px;text-align:center;padding-top:8px;'>
					<i class='icon-unlock'></i>
				</div>
				<div class='pull-left'>
					<strong>Public</strong>
					<span class='help-block'>
						Anyone can see this repository and the data associated
						with it.
					</span>
				</div>
			</label>
			<label class='radio' style='clear:both;'>
				<input type='radio' name='privacy' value='private' style='margin-top:16px;' checked='checked'>
				<div class='pull-left' style='width:32px;text-align:center;padding-top:8px;'>
					<i class='icon-lock'></i>
				</div>
				<div class='pull-left'>
					<strong>Private</strong>
					<span class='help-block'>
						You choose who can see this repository and the data
						associated with it.
					</span>
				</div>
			</label>
			<div style='clear:both;'>
				<hr/>
                    {% if repo_json %}
                <button id='submit_btn' type='submit' class='btn btn-success'>Save Repository</button>
                    {% else %}
				<button id='submit_btn' type='submit' class='btn btn-success'>Create Repository</button>
                    {% endif %}
			</div>
		</form>
	</div>
</div>
{% endblock %}